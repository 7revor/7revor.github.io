<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ACSS | 7revor</title>
    <meta name="description" content="可爱又迷人的反派角色">
    <link rel="icon" href="/docs/img/favicon.ico">
    
    <link rel="preload" href="/docs/assets/css/0.styles.58531315.css" as="style"><link rel="preload" href="/docs/assets/js/app.4ab28825.js" as="script"><link rel="preload" href="/docs/assets/js/17.754c29fe.js" as="script"><link rel="preload" href="/docs/assets/js/2.ad5bf1e0.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.c09cb538.js"><link rel="prefetch" href="/docs/assets/js/11.19268fa3.js"><link rel="prefetch" href="/docs/assets/js/12.c0fee833.js"><link rel="prefetch" href="/docs/assets/js/13.2259e511.js"><link rel="prefetch" href="/docs/assets/js/14.66e6b874.js"><link rel="prefetch" href="/docs/assets/js/15.32a4e212.js"><link rel="prefetch" href="/docs/assets/js/16.41377d65.js"><link rel="prefetch" href="/docs/assets/js/18.fdefc283.js"><link rel="prefetch" href="/docs/assets/js/19.e006c669.js"><link rel="prefetch" href="/docs/assets/js/20.d0150c72.js"><link rel="prefetch" href="/docs/assets/js/21.9b51a425.js"><link rel="prefetch" href="/docs/assets/js/22.210a9e28.js"><link rel="prefetch" href="/docs/assets/js/23.72f62196.js"><link rel="prefetch" href="/docs/assets/js/24.6c17a689.js"><link rel="prefetch" href="/docs/assets/js/25.78548d72.js"><link rel="prefetch" href="/docs/assets/js/26.c13a0274.js"><link rel="prefetch" href="/docs/assets/js/27.4d1478b2.js"><link rel="prefetch" href="/docs/assets/js/28.48ec91ca.js"><link rel="prefetch" href="/docs/assets/js/29.7b1a6e61.js"><link rel="prefetch" href="/docs/assets/js/3.746bb0c2.js"><link rel="prefetch" href="/docs/assets/js/30.e84731d6.js"><link rel="prefetch" href="/docs/assets/js/31.b006719c.js"><link rel="prefetch" href="/docs/assets/js/32.14570730.js"><link rel="prefetch" href="/docs/assets/js/33.ea66e4b8.js"><link rel="prefetch" href="/docs/assets/js/34.c535b5ab.js"><link rel="prefetch" href="/docs/assets/js/35.4a956201.js"><link rel="prefetch" href="/docs/assets/js/36.3d4335b6.js"><link rel="prefetch" href="/docs/assets/js/37.b972a2d7.js"><link rel="prefetch" href="/docs/assets/js/38.866f9b42.js"><link rel="prefetch" href="/docs/assets/js/39.731e50bb.js"><link rel="prefetch" href="/docs/assets/js/4.378f37ca.js"><link rel="prefetch" href="/docs/assets/js/40.6786aa28.js"><link rel="prefetch" href="/docs/assets/js/5.0e492c21.js"><link rel="prefetch" href="/docs/assets/js/6.2bf23e83.js"><link rel="prefetch" href="/docs/assets/js/7.5dbbe719.js"><link rel="prefetch" href="/docs/assets/js/8.d5f186c7.js"><link rel="prefetch" href="/docs/assets/js/9.cf172365.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.58531315.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">7revor</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/MiniApp/" class="nav-link router-link-active">MiniApp</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link">Learning</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/docs/React/" class="nav-link">React</a></div><div class="nav-item"><a href="/docs/Notes/" class="nav-link">Documents</a></div><div class="nav-item"><a href="/docs/MiniApp/" class="nav-link router-link-active">MiniApp</a></div><div class="nav-item"><a href="/docs/Learning/" class="nav-link">Learning</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/MiniApp/miniapp.html" class="active sidebar-link">商家应用知识点梳理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#acss" class="sidebar-link">ACSS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#响应式解决方案" class="sidebar-link">响应式解决方案</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#全屏" class="sidebar-link">全屏</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#滚动容器占满剩余屏幕空间" class="sidebar-link">滚动容器占满剩余屏幕空间</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#盒模型" class="sidebar-link">盒模型</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#axml" class="sidebar-link">AXML</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#注意" class="sidebar-link">注意</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#事件系统" class="sidebar-link">事件系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#事件类型" class="sidebar-link">事件类型</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#参数传递" class="sidebar-link">参数传递</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#组件" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#slot-插槽" class="sidebar-link">slot 插槽</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#事件传递" class="sidebar-link">事件传递</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#mixins-混入" class="sidebar-link">mixins 混入</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#跨组件通信" class="sidebar-link">跨组件通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#路由" class="sidebar-link">路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#缺陷" class="sidebar-link">缺陷</a></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#py-mini-router" class="sidebar-link">py-mini-router</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/MiniApp/miniapp.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/docs/MiniApp/hack.html" class="sidebar-link">无侵入式运营对接方案</a></li><li><a href="/docs/MiniApp/frame.html" class="sidebar-link">全局统一交互实现</a></li><li><a href="/docs/MiniApp/navigate.html" class="sidebar-link">导航功能扩展</a></li><li><a href="/docs/MiniApp/top.html" class="sidebar-link">授权接口调用</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="acss"><a href="#acss" class="header-anchor">#</a> ACSS</h2> <p><a href="https://miniapp.open.taobao.com/doc.htm?docId=117161&docType=1&source=search" target="_blank" rel="noopener noreferrer">ACSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
是一套样式语言，用于描述 AXML 的组件样式，决定 AXML 的组件的显示效果。</p> <p>ACSS 同系统 CSS 规则完全一致，100% 可以用。同时为更适合开发应用，对 CSS 进行了扩充。</p> <h3 id="响应式解决方案"><a href="#响应式解决方案" class="header-anchor">#</a> 响应式解决方案</h3> <p><strong>rpx</strong>（responsive pixel）可以根据屏幕宽度进行自适应，规定屏幕宽为 750rpx</p> <h3 id="全屏"><a href="#全屏" class="header-anchor">#</a> 全屏</h3> <p>由于使用 rpx ，所有设备的横向全屏可以通过设置 <code>width:750rpx</code> 来实现。</p> <p>但不同设备屏幕比例不同，固定设置高度无法兼容所有设备，所以这里需要一点特殊方法。</p> <ul><li>在 <code>app.acss</code> 中配置</li></ul> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">page</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样就可以将所有页面设置为纵向全屏显示。</p> <h3 id="滚动容器占满剩余屏幕空间"><a href="#滚动容器占满剩余屏幕空间" class="header-anchor">#</a> 滚动容器占满剩余屏幕空间</h3> <p>这种需求在移动端是比较常见的：比如一个列表页，头部是固定高度 tabbar，底部是固定高度按钮区，而中间区域占满剩余空间。</p> <p>使用 flex 布局，让容器占满屏幕剩余空间是非常简单的。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.container</span><span class="token punctuation">{</span>
   <span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span>
   <span class="token property">flex</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们的父容器使用 flex 布局，子元素只需设置 flex:1 即可占满剩余空间。但有一种情况例外：</p> <p>子容器在占满剩余空间的同时，超出部分显示滚动条，即需设置 <code>overflow-y:scroll</code></p> <p>那么问题来了，<code>overflow-y:scroll</code> 生效的前提是<strong>必需为容器指定固定高度</strong>，</p> <p>我们可能会想到使用 <code>height:100%</code> 来让子元素占满空间。但要想让高度百分比起作用，一般来说，要满足两个条件：</p> <p><strong>1. 父标签有高度可寻</strong></p> <p>就是向上遍历父标签要找到一个定值高度（html，body除外）。如果中途有个 height 为 auto 或者没有设置 height
的属性，那么百分比不起作用。</p> <p>而使用之前 <code>flex:1</code> 的设置，父元素虽然占满剩余空间，但它的高度是缺省值，也就是 <code>height:auto</code> ，是没有<strong>准确</strong>高度的。</p> <p>如果使用 <code>height:100%</code> 来继承父元素缺省值的高度，<code>100% * auto</code> 是没法计算的，浏览器不会对这个值有任何的反应。</p> <p>而且由于手机屏幕比例不同，我们无法给父标签统一设置定值高度。</p> <p><strong>2. 绝对定位</strong></p> <p>当子标签使用绝对定位时，元素本身脱离文档流，它的高度计算只取决于最近的相对定位元素。这时 height:100% 也可生效。</p> <p>综上我们有两种方案可以实现此需求：</p> <ul><li><strong>子绝父相</strong></li></ul> <p>父容器设置</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.container</span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span>relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>子元素设置</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.scroller</span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p> <p>子元素绝对定位是计算父元素的 padding 值的。而传统的 height:100% 是不计算的。当然使用全局的box-sizing: border-box就不用担心了。</p></div> <ul><li><strong>为父元素设置定值高度</strong></li></ul> <p>父容器设置</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.container</span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>子元素设置</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.scroller</span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span>
  <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>父元素设置 <code>height:0</code>，改变其高度缺省值设置，而 <code>flex:1</code> 又使父元素高度占满剩余空间，这时子元素的 <code>height:100%</code> 可以正确继承到父元素的实际高度。</p> <blockquote><p>小程序框架中的 <code>&lt;scroll-view/ &gt;</code> 组件亦是如此。</p></blockquote> <h3 id="盒模型"><a href="#盒模型" class="header-anchor">#</a> 盒模型</h3> <h4 id="border-box"><a href="#border-box" class="header-anchor">#</a> border-box</h4> <p>在我们熟悉的QAP体系中，所使用的盒模型均为IE盒模型 <code>border-box</code></p> <p>此时元素 <code>width = content + padding + border</code></p> <p>比如，我们定义一个 <code>&lt;view&gt;</code> 的样式:</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">view</span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span>100px<span class="token punctuation">;</span>
  <span class="token property">padding-left</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
  <span class="token property">border-left</span><span class="token punctuation">:</span> 25px solid red<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div id="Picture" class="pic-container"><img src="/docs/img/mini-app/border-box.jpg" style="width:300px;"> <p>border-box</p></div> <p>此时可以观察到，它所占的空间就是 100px</p> <p>由于 25px 的内边距和边框，它的实际内容区宽度被压缩到了只剩 50px</p> <h4 id="content-box"><a href="#content-box" class="header-anchor">#</a> content-box</h4> <p>而在小程序框架中，所使用的盒模型为W3C标准和模型 <code>content-box</code></p> <p>此时元素 <code>width = content</code></p> <p>同样我们定义一个 <code>&lt;view&gt;</code> 的样式:</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">view</span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span>100px<span class="token punctuation">;</span>
  <span class="token property">padding-left</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span>25px solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div id="Picture" class="pic-container"><img src="/docs/img/mini-app/content-box.jpg" style="width:300px;"> <p>content-box</p></div> <p>此时可以观察到，它所占的空间变成了 <code>100 + 25 + 25 = 150px</code></p> <p>由于 25px 的内边距和边框，它的内容区宽度 100px 保持不变，所占空间被扩大到 150px</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>可以通过设置 <code>box-sizing</code> 来改变盒模型标准。</p></div> <h2 id="axml"><a href="#axml" class="header-anchor">#</a> AXML</h2> <p><a href="https://miniapp.open.taobao.com/doc.htm?docId=117166&docType=1&source=search" target="_blank" rel="noopener noreferrer">AXML<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
是应用框架设计的一套标签语言，用于描述应用页面的结构，总体和 <a href="https://cn.vuejs.org" target="_blank" rel="noopener noreferrer">Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的语法很相似。</p> <p>AXML 语法可分为五个部分
<a href="https://miniapp.open.taobao.com/doc.htm?docId=117165&docType=1&source=search" target="_blank" rel="noopener noreferrer">数据绑定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、
<a href="https://miniapp.open.taobao.com/doc.htm?docId=117164&docType=1&source=search" target="_blank" rel="noopener noreferrer">条件渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、
<a href="https://miniapp.open.taobao.com/doc.htm?docId=117160&docType=1&source=search" target="_blank" rel="noopener noreferrer">列表渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、
<a href="https://miniapp.open.taobao.com/doc.htm?docId=117162&docType=1&source=search" target="_blank" rel="noopener noreferrer">模板<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、
<a href="https://miniapp.open.taobao.com/doc.htm?docId=117163&docType=1&source=search" target="_blank" rel="noopener noreferrer">引用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>关于AXML语法，官方文档已经写的很详细了，这里就不再浪费篇幅，不过有一点需要注意。</p> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>a-if 表达式支持的语法：</p> <ul><li><code>+</code> <code>-</code> <code>===</code> <code>!==</code> <code>||</code> <code>&amp;&amp;</code> <code>&gt;</code> <code>&lt;</code> 等逻辑运算（以及任意组合）</li> <li>支持 ES5 及之前的部分语法（形如 <code>Array.prototype.indexOf</code>）</li> <li>不支持ES6语法（形如 <code>Map.prototype.has</code> <code>Array.prototype.contains</code>）</li></ul> <h2 id="事件系统"><a href="#事件系统" class="header-anchor">#</a> 事件系统</h2> <p><a href="https://miniapp.open.taobao.com/doc.htm?docId=117158&docType=1&source=search" target="_blank" rel="noopener noreferrer">事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是视图层到逻辑层的通讯方式。</p> <p>在 React 中，如果想要在 view 中绑定事件，可以像这么操作：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clickHandler<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">添加</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">addSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们想要为点击事件传递额外参数，可以使用 bind：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clickHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>item<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">添加</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">clickHandler</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">addSomething</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而在小程序框架中，事件绑定看起来也差不多，首先在 axml 中绑定一个事件处理函数:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tapHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p> <p>注意是要用<strong>字符串</strong>的形式传入，而不需要使用花括号{{}}包裹。这里要和数据绑定做好区分！！！</p></div> <p>在相应的 Page 中定义相应的事件处理函数 tapHandler，参数为事件对象 event。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">tapHandler</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">addSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="事件类型"><a href="#事件类型" class="header-anchor">#</a> 事件类型</h3> <h4 id="冒泡事件"><a href="#冒泡事件" class="header-anchor">#</a> 冒泡事件</h4> <p>以关键字 on 为前缀，当组件上的事件被触发，该事件会向父节点传递。</p> <h4 id="非冒泡事件"><a href="#非冒泡事件" class="header-anchor">#</a> 非冒泡事件</h4> <p>以关键字 catch 为前缀，当组件上的事件被触发，该事件不会向父节点传递</p> <h3 id="参数传递"><a href="#参数传递" class="header-anchor">#</a> 参数传递</h3> <p>我们为事件传递额外参数时，需要借助 dataset:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">data-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tapHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>获取参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">tapHandler</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>item<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>事件系统会将<code>data-</code>开头的属性封装到 <code>event.target.dataset</code> 中，其中：</p> <ul><li><code>data-</code> 以及之后的 <code>-</code> 会被忽略。</li> <li>除<code>data-</code>后的首字母外，其他的<code>-</code>后首字母转为大写。</li></ul> <p>eg:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">data-template-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>123<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span> // 会被转换为 dataset.templateId
</code></pre></div><blockquote><p>官方文档中说明除 <code>-</code> 后的首字母转换为大写外，其他字母均转为小写，例如：data-templateId会转换为templateid,实测没有转换，dataset中仍为templateId。</p></blockquote> <h2 id="组件"><a href="#组件" class="header-anchor">#</a> 组件</h2> <p>任何一个前端 MVVM 框架中，组件都是其必不可少的重要组成部分。小程序框架中也有<a href="https://miniapp.open.taobao.com/doc.htm?docId=117188&docType=1&source=search" target="_blank" rel="noopener noreferrer">组件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>系统。</p> <p>与页面类似，自定义组件可以有自己的 axml 模板和 acss 样式。</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>与页面不同，用户自定义事件需要放到 methods 里面。</p></div> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p>组件的生命周期函数在特殊的时间点由框架触发。组件生命周期如下：</p> <table><thead><tr><th>生命周期</th> <th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><code>onInit</code></td> <td>无</td> <td>组件创建时触发</td></tr> <tr><td><code>deriveDataFromProps</code></td> <td><code>nextProps</code></td> <td>组件创建时和更新前触发</td></tr> <tr><td><code>didMount</code></td> <td>无</td> <td>组件创建完毕时触发</td></tr> <tr><td><code>didUpdate</code></td> <td><code>(prevProps,prevData)</code></td> <td>组件更新完毕时触发</td></tr> <tr><td><code>didUnmount</code></td> <td>无</td> <td>组件删除时触发</td></tr></tbody></table> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>onInit、deriveDataFromProps 自基础库 1.14.0 才支持，需要在开发者工具中的 详情 &gt; 项目配置 中，勾选 component2。</p></div> <p>这里主要介绍 deriveDataFromProps 和 didUpdate 两个生命周期。</p> <h4 id="derivedatafromprops"><a href="#derivedatafromprops" class="header-anchor">#</a> deriveDataFromProps</h4> <p>在组件 <code>创建和更新前</code> 都会触发。</p> <p>正因他是在更新前触发，所以在其内部调用 <code>setData</code> 会将更新请求合并，不会重新触发 deriveDataFromProps 而导致死循环。</p> <p>熟悉Vue的同学可以把它当做是 <code>computed</code> 来用，可以用来计算存储一些相对复杂的属性。</p> <p>比如现在我们的商品列表组件需要统计所有的商品数量。</p> <p>传统的方法是这样：</p> <p><strong>AXML</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>商品总数为:{{onsale.length + inventory.length + soldout.length}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>而使用 deriveDataFromProps 优化后：</p> <p><strong>AXML</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>JS</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span><span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deriveDataFromProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>onsale<span class="token punctuation">,</span>inventory<span class="token punctuation">,</span>soldout<span class="token punctuation">}</span> <span class="token operator">=</span> nextProps<span class="token punctuation">;</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> onsale<span class="token punctuation">.</span>length<span class="token operator">+</span>inventory<span class="token punctuation">.</span>length<span class="token operator">+</span>soldout<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这只是相对简单的情况，优化后的效果不明显。</p> <p>当然实际项目中的需求也不会这么简单，如果要在统计的基础上进行筛选过滤等操作，效果就比较明显了。</p> <h4 id="didupdate"><a href="#didupdate" class="header-anchor">#</a> didUpdate</h4> <p>在组件 <code>更新后</code> 都会触发。</p> <p><strong>如果在其内部调用 <code>setData</code>，会导致页面死循环，所以要避免在 didUpdate 中进行数据更新。</strong></p> <p>它的使用场景大多是组件更新后通知父组件或者子组件等对组件数据流没有影响的操作。</p> <h3 id="slot-插槽"><a href="#slot-插槽" class="header-anchor">#</a> slot 插槽</h3> <p>通过在组件 axml 中传入 props，自定义组件可以和外部调用者交互，接受外部调用者传来的数据。</p> <p>同时可以调用外部调用者传来的函数，通知外部调用者组件内部的变化。</p> <p>现在我们有一个按钮组件，他可以接收外部的 content props，来渲染不同的按钮文本。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>删除<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>内部实现：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{content}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>现在新增一个需求，有些按钮可能不需要显示文本内容，而需要显示一张图片，这时候怎么做呢？</p> <p>我们可以给它加一个 type 属性，来控制按钮的类型：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">a-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>type==='img'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{src}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://xxx.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>看起来没什么问题。但如果我们又有新的需求进来呢？不停的增加 type 吗？显然这不是我们想看到的。</p> <p>这样的话自定义组件未免太不够灵活。这时我们就引入了slot：</p> <p><strong>slot 使得自定义组件的 axml 结构可以使用外部调用者传来的 axml 组装</strong></p> <p>这样一来，我们的 btn 不需要关心要渲染什么，你外部传递给我啥我就渲染啥</p> <p>内部实现：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://xxx.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其实这里的 slot 就相当于 React 中的 children props，在 React 中我们可以这么实现</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这么看起来，是不是比之前使用 type 来控制渲染灵活多了呢？</p> <h4 id="默认插槽-default-slot"><a href="#默认插槽-default-slot" class="header-anchor">#</a> 默认插槽 default slot</h4> <p>有时候可能我们需要一个默认模板，当外部没有传入渲染内容时，将会渲染这个默认模板。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这时如果我们使用 btn 组件而未传入模板，他会渲染一个名为 按钮 的 btn</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h4 id="具名插槽-named-slot"><a href="#具名插槽-named-slot" class="header-anchor">#</a> 具名插槽 named slot</h4> <p>复杂的组件需要在不同位置渲染不同的 axml，即需要传递多个 axml。此时需要 named slot。</p> <p>使用具名插槽后，外部调用者让 传入的 axml 对号入座，渲染到指定的位置。</p> <p>比如我有一个 dialog 组件，它分为三部分，header，content 以及 footer。每部分都有默认模板，我也可以具体定制某一部分的显示内容：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>确定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>正常使用 dialog 组件，它含有默认的头部和尾部，传入的 axml 将会渲染在 <code>&lt;slot /&gt;</code> 标签处。</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">&gt;</span></span>
  确定要删除吗？
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>我们可以对头部和尾部进行定制，只需给标签指定slot属性：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>警告<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  确定要删除吗？
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>确定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这是，我们的<code>&lt;view slot=&quot;header&quot;&gt;</code>将会渲染在 name 属性为 header 的标签处，</p> <p>而<code>&lt;view slot=&quot;footer&quot;&gt;</code>则会渲染在 name 属性为 footer 的标签处，文本内容正常渲染在中间。</p> <h4 id="作用域插槽-slot-scope"><a href="#作用域插槽-slot-scope" class="header-anchor">#</a> 作用域插槽 slot-scope</h4> <p>通过的 props 属性，我们可以在组件内部访问外部数据。而有些时候，在外部访问组件内部数据也是有必要的。</p> <p>先看我们 QAP 中常用的组件 <code>&lt;ListView/&gt;</code></p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ListView</span></span>        
        <span class="token attr-name">renderRow</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderItem</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">dataSource</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">renderItem</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 ListView 组件中，renderItem 方法就像是一个插槽，ListView 组件不去关心如何去渲染每一行数据，而是向外暴露一个 renderRow 方法，我把每一行的数据向外传递给父组件，你父组件来决定如何渲染。</p> <p>这种场景就是我们提到的在外部访问组件内部数据。那么在小程序中，这种组件要怎么实现呢？</p> <p><strong>ListView.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>list-view-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">a-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{dataSource}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>我们在组件内部对 dataSource 进行遍历，循环渲染其每一行，并且通过 slot 标签上的 item 属性将每一行的数据暴露给父组件</p> <p><strong>page.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list-view</span> <span class="token attr-name">dataSource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{list}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scope<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     {{scope.item.name}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list-view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>页面使用组件时，通过 slot-scope 申明为作用域插槽，属性值定义临时变量名 scope，即可访问到组件内部暴露出来的数据。</p> <h3 id="事件传递"><a href="#事件传递" class="header-anchor">#</a> 事件传递</h3> <p>我们的自定义组件中难免会处理一些事件，事件在组件中的传递和 React 大同小异：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>到这里我们会发现点击事件不能正常触发，不能触发就对了😂</p> <p>因为<code>onTap</code>是原生 view 或者 button 中的属性，我们的 btn 组件并未对 onTap 属性进行处理。</p> <p><strong>btn.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">didMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onTap<span class="token punctuation">)</span> <span class="token comment">// 我们定义的onTap事件在这里</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">tapHandler</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 这里首先要声明事件，并且在事件触发时，手动触发父页面传入的onTap</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onTap<span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onTap</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>btn.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tapHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样，我们点击 btn 组件时，实际上处罚的是 btn 中 view 的 onTap 事件，而在其处理函数中，手动对外部绑定的事件进行触发。</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>自定义中传递的事件属性必须以 on 或者 catch 开头，且其后首字母必须大写，比如 onChange 或者 catchChange，这样才可以正常识别事件，如果不遵循此规范
（比如使用 onchange 或者 change），那么传递给组件的就仅仅是一个字符串</p></div> <h4 id="参数传递-2"><a href="#参数传递-2" class="header-anchor">#</a> 参数传递</h4> <p>通过上文我们知道想要在事件中传递额外参数需要借助 dataset，我们尝试一下</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>我们会发现打印出来的 dataset 是一个空对象，那么我们绑定的<code>data-item</code>去哪里了呢？</p> <p>这里要搞清一点：event 上的 target 指的是触发事件的元素，显然这里的 target 指的是 btn 组件内部的 view，这个 view 上并没有 data-item，所以事件对象中也没有
我们想要的 item 属性。</p> <p>而我们 data-item 是绑定在 btn 标签上的，他是作为了 btn 组件的 props：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">didMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token comment">//这里可以找到我们的 data-item</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在这里有两种方案可以选择。</p> <p><strong>一是为自定义组件手动设置 dataset</strong></p> <p><strong>btn.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tapHandler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>page.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>btn</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>btn</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样就可以在 event 中正常获取到 item 对象。这么处理好处是比较简单，适用于组件功能固定的情况。</p> <p>当我们的组件功能比较开放，可能我在这里需要传递 item ，而另一个页面需要传递 id，或者我需要传递多个参数，这就行不同了。</p> <p><strong>第二种处理方式是借助一个 fmtEvent 方法来将 props 中的 data-item 合并到事件对象中</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 为自定义组件事件传递dataset
 * @param {props} props 组件props
 * @param {event} event 事件对象
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fmtEvent</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> dataset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^data-.*/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> dataKey <span class="token operator">=</span> <span class="token function">getKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      dataset<span class="token punctuation">[</span>dataKey<span class="token punctuation">]</span> <span class="token operator">=</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> newDataset <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>dataset<span class="token punctuation">,</span> <span class="token operator">...</span>dataset <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>event<span class="token punctuation">,</span>
    currentTarget<span class="token operator">:</span> <span class="token punctuation">{</span>
      dataset<span class="token operator">:</span> newDataset
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>
      dataset<span class="token operator">:</span> newDataset<span class="token punctuation">,</span>
      targetDataset<span class="token operator">:</span> newDataset
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 提取 data- 后的内容，删除 - 且将 - 后的第一个字符改为大写
 * @param {string} key dataset key eg.data-userId
 */</span>
<span class="token keyword">function</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^data-)|(-)(.)/g</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> f<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里我们将组件所有以<code>data-</code>开头的props都提取出来，合并到 event 中。这样任何参数名以及参数个数都可以从容处理。</p> <blockquote><p>mini-antui中也是采用这种方式对事件参数进行传递，不过他所提供的方法比较简单，仅仅是合并数据。这里提供的处理方法比较完善。</p></blockquote> <h3 id="mixins-混入"><a href="#mixins-混入" class="header-anchor">#</a> mixins 混入</h3> <p>mixins主要是用来提取公共逻辑以便复用。</p> <p>它和组件有着相同的定义方式。</p> <h4 id="demo-js"><a href="#demo-js" class="header-anchor">#</a> demo.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mixin init!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token function">deriveDataFromProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">didMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">didUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span>prevData</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">didUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="component-js"><a href="#component-js" class="header-anchor">#</a> component.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用时只需引入相应的mixin</span>
<span class="token keyword">import</span> demo <span class="token keyword">from</span> <span class="token string">'./demo'</span><span class="token punctuation">;</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mixins<span class="token operator">:</span><span class="token punctuation">[</span>demo<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">onInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'component init!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>组件引入目标 mixin 后，会将其所有<strong>属性</strong>、<strong>方法</strong> 合并到当前组件(当前组件为主，重名替换)。</p> <p>而对于生命周期函数比如 onInit，若重复定义则会先执行mixin中的 onInit 再执行组件中的 onInit</p> <p>即先打印 mixin init! 再打印 component init!。</p> <h4 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h4> <p>像上文中对自定义组件事件的传递，我们的 btn 组件需要，checkbox 以及 radio 组件都需要，我们就可以封装一个 mixin 来处理事件传递。</p> <p><strong>customEvent.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>fmtEvent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'/util/tool'</span>
<span class="token comment">/**
 * 自定义组件点击事件处理
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">tapHandler</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onTap<span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>disable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onTap <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> ev <span class="token operator">=</span> <span class="token function">fmtEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> event<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onTap</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'tap event must be type of function'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用：</p> <p><strong>btn.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> customEvent <span class="token keyword">from</span> <span class="token string">'./mixins/customEvent'</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mixins<span class="token operator">:</span><span class="token punctuation">[</span>customEvent<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>btn.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">onTap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>tapHandler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里 customEvent 将 tapHandler 注入组件原型，我们可以直接在 axml 中使用改事件。</p> <h3 id="跨组件通信"><a href="#跨组件通信" class="header-anchor">#</a> 跨组件通信</h3> <p>在实际项目中，我们会有很多时候需要跨组件甚至是跨页面通信。在 QAP 中，SDK 为我们提供了一套事件 API 供我们使用。</p> <p>在小程序中，没有为我们提供这样一个API，需要我们引入第三方库，这里推荐 NodeJs 的
<a href="http://nodejs.cn/api/events.html" target="_blank" rel="noopener noreferrer">Event<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模块。</p> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> events <span class="token comment"># 或者 yarn add events</span>
</code></pre></div><h4 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h4> <p><strong>app.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'events'</span><span class="token punctuation">;</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    my<span class="token punctuation">.</span>$event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册全局事件监听</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>推荐直接将 event 对象挂载到 my 当中。在小程序环境中，没有全局的 window 或者 document 对象供我们使用，借助 my 可以在任何地方
简单快捷的使用事件。</p> <h4 id="事件监听"><a href="#事件监听" class="header-anchor">#</a> 事件监听</h4> <div class="language-js extra-class"><pre class="language-js"><code>my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span>handler<span class="token punctuation">)</span>
</code></pre></div><h4 id="事件触发"><a href="#事件触发" class="header-anchor">#</a> 事件触发</h4> <div class="language-js extra-class"><pre class="language-js"><code>my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
</code></pre></div><h4 id="事件销毁"><a href="#事件销毁" class="header-anchor">#</a> 事件销毁</h4> <div class="language-js extra-class"><pre class="language-js"><code>my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span>handler<span class="token punctuation">)</span>
</code></pre></div><p><strong>注意</strong></p> <p>EventEmitter 在监听同名事件时，不会覆盖掉前面的监听函数。它内部对每一个事件名下的所有处理函数使用数组进行存储。也就是说，我们要及时对事件进行销毁。</p> <p>不然的话，在首页 onLoad 我注册了一个事件，用户跳转到其他页面，又回到首页，那么 onLoad 会再次注册改事件，导致内存泄漏。</p> <p>关于事件销毁也要注意：事件销毁时，除事件名一致外，传入的 handler 必须与监听时的处理函数为同一个对象，才可以销毁。</p> <p>也就是说，我们不可以使用匿名函数来监听事件：</p> <div class="language-js extra-class"><pre class="language-js"><code>my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">//xxx</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样监听的事件是永远无法销毁的，因为我们无法再次拿到处理函数的引用。</p> <p>我们可以这样</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">eventNameHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// xxx</span>
<span class="token punctuation">}</span>
my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventNameHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventNameHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果我们不使用箭头函数来定义 handler ，当事件触发时，handler 内部的 this 并不会指向组件实例。</p> <p>可以借助 bind：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>eventNameHandler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eventNameHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventNameHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventNameHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这里还有一个常见错误会发生：可能会有的同学这么写：</p> <div class="language-js extra-class"><pre class="language-js"><code>my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eventNameHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
my<span class="token punctuation">.</span>$event<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'eventName'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eventNameHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这种写法是无法成功销毁事件监听的。因为每次 bind，<strong>都会生成一个新的函数对象</strong>。也就是说：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eventNameHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eventNameHandler</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <p>PC端为我们提供了<a href="https://miniapp.open.taobao.com/doc.htm?docId=117509&docType=1&source=search" target="_blank" rel="noopener noreferrer">路由组件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，我们可以在千牛PC端搭建单页面应用（SPA），单页应用的优点相比不用过多赘述。</p> <p>但是他这个路由文档比较少，配置看起来也不太容易理解。接下来就从原理开始一起学习一下这个小程序框架中的路由组件。</p> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>在小程序框架中使用路由，由于没有 window 对象，自然也就没有 history。实现路由的话，大概也就只有一种方式了，那就是使用 slot。</p> <p>上文中我们介绍了 slot 具名插槽，而路由的精髓也就是这个具名插槽，先看下路由组件，很简单，就三行：</p> <p><strong>router-view.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{name}}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这么简短的代码怎么实现页面切换的呢？其实很简单，举例说明：
<strong>page.axml</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{name}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span>  <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>first<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
   第一页
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span>  <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>second<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
   第二页
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span>  <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>third<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
   第三页
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>page.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'first'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">pageChange</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>看到这里我想已经可以理解路由的工作原理了：使用具名插槽，动态为 router-view 组件设置 slot 的插槽名称，来渲染不同的组件。</p> <p>当<code>name = 'first'</code>时，显示第一页，当<code>name = 'second'</code>时，就显示slot为second的view，以此类推。</p> <p>基于这个原理，将 pageChange 封装到路由组件内部，当我们 push 新的路径时，计算并设置要显示的插槽名，也就是我们使用的路由了。</p> <h3 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h3> <p>基于上面的理解，我们再回过头来看一下文档中的配置（部分）：</p> <p><strong>路由定义</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span> 
      children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/scene'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'scene'</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/select'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'select'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/slider'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'slider'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">'/menu'</span><span class="token punctuation">,</span> component<span class="token operator">:</span> <span class="token string">'menu'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>页面</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code>//page.axml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>body-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>home</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>home<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scene</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scene<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>看到页面中的<code>&lt;home slot=&quot;home&quot; /&gt;</code>可能有点晕，这是啥跟啥，其实他这么写文档有点迷惑人的味道，又是 path 又是
component 又是 slot 的，弄得有点懵。</p> <p>这里面最关键的就是路由定义中的 <code>component: 'home'</code> 以及页面中的 <code>slot=&quot;home&quot;</code>。</p> <p>我们完全可以这么写页面：</p> <div class="language-vue extra-class"><pre class="language-vue"><code>//page.axml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>body-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>home<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
		  home
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scene<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
		  scene
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>看到这里是不是和我们刚才分析的原理有点像了?</p> <p>实际上，当我们 <code>push('home')</code>时，就会把 <code>&lt;router-view&gt;</code> 中的 <code>name</code> 属性设置为<code>home</code>，
这是页面上也就响应的显示出 <code>slot=&quot;home&quot;</code> 的页面。</p> <h3 id="缺陷"><a href="#缺陷" class="header-anchor">#</a> 缺陷</h3> <ol><li><strong>不允许两个router-view在同一层级中出现。</strong></li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样使用是不可以的，但实际使用中这种需求还是有的。比如我有一个店铺收藏拉粉页，他下面有两个子路由，每个子路由又分为创建活动，活动管理，领取记录三个页面。</p> <p>理想化的路由设置是这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/shop-favor'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> <span class="token string">'shop-favor'</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/coupon'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'coupon'</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/activity'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'/activity'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/create'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'/create'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/record'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'/record'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/gifts'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> <span class="token string">'gifts'</span><span class="token punctuation">,</span>
      children<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/activity'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'/activity'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/create'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'/create'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          path<span class="token operator">:</span> <span class="token string">'/record'</span><span class="token punctuation">,</span>
          component<span class="token operator">:</span> <span class="token string">'/record'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们的店铺收藏拉粉页</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>coupon<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>coupon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>activity<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>create</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>coupon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>create<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>coupon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>record<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>gifts<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gifts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>activity<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>create</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gifts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>create<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>record</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gifts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>record<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>那么抱歉，coupon 下的 router-view 和 gifts 下的 router-view 是属于同一层级，这是会渲染失败的。</p> <ol start="2"><li><strong>path-to-regexp</strong>中的bug
如果我们需要在页面跳转时传递参数，可以如此配置</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/shop-favor/:id'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> <span class="token string">'shop-favor'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>页面跳转</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'shop-favor/123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转成功，可以获取参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'shop-favor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转失败，路由匹配不到</span>

</code></pre></div><p>很多情况下我们需要使用可选参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  path<span class="token operator">:</span> <span class="token string">'/shop-favor/:id?'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> <span class="token string">'shop-favor'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>页面跳转</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'shop-favor/123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转成功，无法获取参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'shop-favor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转成功</span>
</code></pre></div><p>当我们使用可选参数进行跳转时，bug出现了，无法在页面中获取到参数😂</p> <p>之前的解决方式是一律使用必填参数，当不需要参数时传递0</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'shop-favor/123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转成功,可以获取参数</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'shop-favor/0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳转成功</span>
</code></pre></div><p>脑壳疼。</p> <h3 id="py-mini-router"><a href="#py-mini-router" class="header-anchor">#</a> <a href="https://www.npmjs.com/package/py-mini-router" target="_blank" rel="noopener noreferrer">py-mini-router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>基于上面（还有很多）使用过程中的痛点，我的初始想法是到git上提issue，结果找不到人，npm上也没有任何联系方式，无奈只好自己手撸了一个路由：</p> <ul><li>舍弃 path-to-regexp 路由匹配方式，采用Object进行跳转以及传参，使用更加灵活。</li> <li>支持自定义路由配置，可在当前页面实时获取，扩展性更高。</li> <li>允许两个 router-view 在同一层级中出现。
<a href="https://www.npmjs.com/package/py-mini-router" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/7revor/mini-router" target="_blank" rel="noopener noreferrer">项目传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://miniapp.open.taobao.com/doc.htm?docId=117200&docType=1&source=search" target="_blank" rel="noopener noreferrer">商家应用官方开发文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">12/6/2019, 1:43:58 AM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/docs/MiniApp/hack.html">
          无侵入式运营对接方案
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/app.4ab28825.js" defer></script><script src="/docs/assets/js/17.754c29fe.js" defer></script><script src="/docs/assets/js/2.ad5bf1e0.js" defer></script>
  </body>
</html>
